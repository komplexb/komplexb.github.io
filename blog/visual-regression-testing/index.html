<!doctype html>
<html data-n-head-ssr>
  <head>
    <title>Visual Regression Tests for Storybooks | Byron Buckley</title><meta data-n-head="ssr" charset="utf-8"><meta data-n-head="ssr" name="HandheldFriendly" content="True"><meta data-n-head="ssr" name="viewport" content="width=device-width,initial-scale=1"><meta data-n-head="ssr" property="og:site_name" content="Byron Buckley"><meta data-n-head="ssr" data-hid="keywords" name="keywords" content="css, scss, sass, javascript, vue, vuejs, ui, ux, front-end, developer, engineer, usability, electron, aws, serverless"><meta data-n-head="ssr" data-hid="description" name="description" content="Implementing visual regression testing in Storybook with Storyshots and Puppeteer."><meta data-n-head="ssr" data-hid="og:type" property="og:type" content="article"><meta data-n-head="ssr" data-hid="og:url" property="og:url" content="undefined/articles/visual-regression-testing"><meta data-n-head="ssr" data-hid="og:title" property="og:title" content="Visual Regression Tests for Storybooks"><meta data-n-head="ssr" data-hid="og:description" property="og:description" content="Implementing visual regression testing in Storybook with Storyshots and Puppeteer."><meta data-n-head="ssr" data-hid="twitter:url" name="twitter:url" content="undefined/articles/visual-regression-testing"><meta data-n-head="ssr" data-hid="twitter:title" name="twitter:title" content="Visual Regression Tests for Storybooks"><meta data-n-head="ssr" data-hid="twitter:description" name="twitter:description" content="Implementing visual regression testing in Storybook with Storyshots and Puppeteer."><meta data-n-head="ssr" property="article:published_time" content="2023-09-22T00:00:00.000Z"><meta data-n-head="ssr" property="article:modified_time" content="2023-09-25T21:59:11.304Z"><meta data-n-head="ssr" property="article:tag" content=""><link data-n-head="ssr" rel="icon" type="image/svg" href="/assets/img/svg/logo.svg"><link data-n-head="ssr" data-hid="canonical" rel="canonical" href="https://byronbuckley.com/blog/visual-regression-testing"><link rel="preload" href="/_nuxt/878f78e.js" as="script"><link rel="preload" href="/_nuxt/184d8ea.js" as="script"><link rel="preload" href="/_nuxt/vendors/app.4bfb361.css" as="style"><link rel="preload" href="/_nuxt/b14aa09.js" as="script"><link rel="preload" href="/_nuxt/app.a266bef.css" as="style"><link rel="preload" href="/_nuxt/a190463.js" as="script"><link rel="preload" href="/_nuxt/pages/blog/_slug.2e53b80.css" as="style"><link rel="preload" href="/_nuxt/6441c06.js" as="script"><link rel="stylesheet" href="/_nuxt/vendors/app.4bfb361.css"><link rel="stylesheet" href="/_nuxt/app.a266bef.css"><link rel="stylesheet" href="/_nuxt/pages/blog/_slug.2e53b80.css"><link rel="preload" href="/_nuxt/static/1695680987/blog/visual-regression-testing/payload.js" as="script"><link rel="preload" href="/_nuxt/static/1695680987/manifest.js" as="script">
  </head>
  <body>
    <div data-server-rendered="true" id="__nuxt"><!----><div id="__layout"><div><div class="svg-sprite-wrapper"><svg width="0" height="0" style="position:absolute"><symbol id="back" viewBox="0 -3 42 42"><path d="M23.9 27.1c-.3 0-.5-.1-.7-.3l-8.1-8.1c-.4-.4-.4-1 0-1.4l8.1-8.1c.4-.4 1-.4 1.4 0s.4 1 0 1.4L17.2 18l7.4 7.4c.4.4.4 1 0 1.4-.2.2-.4.3-.7.3zM21 4c7.7 0 14 6.3 14 14s-6.3 14-14 14S7 25.7 7 18 13.3 4 21 4m0-2C12.2 2 5 9.2 5 18s7.2 16 16 16 16-7.2 16-16S29.8 2 21 2z"></path></symbol> <symbol id="browser" viewBox="0 0 95 95"><path d="M70 28H25c-.8 0-1.5.7-1.5 1.5v36c0 .8.7 1.5 1.5 1.5h45c.8 0 1.5-.7 1.5-1.5v-36c0-.8-.7-1.5-1.5-1.5zm-1.5 36h-42V41.7h42V64zm0-25.3h-42V31h42v7.7zm-37.2-2.4c.8 0 1.4-.6 1.4-1.4s-.6-1.4-1.4-1.4-1.3.6-1.3 1.4.6 1.4 1.3 1.4zm5.4 0c.8 0 1.4-.6 1.4-1.4s-.6-1.4-1.4-1.4-1.4.6-1.4 1.4.6 1.4 1.4 1.4zm5.3 0c.8 0 1.4-.6 1.4-1.4s-.6-1.4-1.4-1.4-1.4.6-1.4 1.4.7 1.4 1.4 1.4z"></path></symbol> <symbol id="browser2" viewBox="0 0 42 32"><path fill="#c99065" d="M41.5 10c-.276 0-.5.224-.5.5v20c0 .276-.224.5-.5.5h-39c-.276 0-.5-.224-.5-.5v-20c0-.276-.224-.5-.5-.5s-.5.224-.5.5v20c0 .827.673 1.5 1.5 1.5h39c.827 0 1.5-.673 1.5-1.5v-20c0-.276-.224-.5-.5-.5zm-1-10h-39C.673 0 0 .673 0 1.5v6c0 .276.224.5.5.5h41c.276 0 .5-.224.5-.5v-6c0-.827-.673-1.5-1.5-1.5zm.5 7H1V1.5c0-.276.224-.5.5-.5h39c.276 0 .5.224.5.5V7zM17.5 28c.276 0 .5-.224.5-.5v-16c0-.276-.224-.5-.5-.5h-13c-.276 0-.5.224-.5.5v16c0 .276.224.5.5.5h13zM5 12h12v15H5V12zm17.5 3h15c.276 0 .5-.224.5-.5s-.224-.5-.5-.5h-15c-.276 0-.5.224-.5.5s.224.5.5.5zm0 5h15c.276 0 .5-.224.5-.5s-.224-.5-.5-.5h-15c-.276 0-.5.224-.5.5s.224.5.5.5zm0 5h15c.276 0 .5-.224.5-.5s-.224-.5-.5-.5h-15c-.276 0-.5.224-.5.5s.224.5.5.5zM3 4c0 .552.448 1 1 1s1-.448 1-1-.448-1-1-1-1 .448-1 1zm4 0c0 .552.448 1 1 1s1-.448 1-1-.448-1-1-1-1 .448-1 1zm4 0c0 .552.448 1 1 1s1-.448 1-1-.448-1-1-1-1 .448-1 1z"></path></symbol> <symbol id="camera2" viewBox="0 0 42 32"><path fill="#c99065" d="M39.5 6H32c-1.927 0-1.998-1.797-2-2V3c0-1.258-1.39-3-4-3h-9.97c-2.934 0-4 1.794-4 3v.994C12.03 4.076 11.984 6 10 6H2.5C1.12 6 0 7.122 0 8.5v18C0 27.878 1.12 29 2.5 29h6c.276 0 .5-.224.5-.5s-.224-.5-.5-.5h-6c-.827 0-1.5-.673-1.5-1.5V14h8c-.644 1.54-1 3.23-1 5 0 7.168 5.832 13 13 13s13-5.832 13-13c0-1.77-.36-3.46-1.003-5H41v12.5c0 .827-.673 1.5-1.5 1.5h-7c-.276 0-.5.224-.5.5s.224.5.5.5h7c1.38 0 2.5-1.122 2.5-2.5v-18C42 7.122 40.88 6 39.5 6zM21 31c-6.617 0-12-5.383-12-12S14.383 7 21 7s12 5.383 12 12-5.383 12-12 12zm11.75-18c-.074 0-.143.018-.206.047C30.38 8.867 26.022 6 21 6s-9.38 2.868-11.544 7.047c-.063-.03-.132-.047-.206-.047H1V8.5C1 7.673 1.673 7 2.5 7H10c2.368 0 3.02-1.958 3.03-3V3c0-.804.8-2 3-2H26c2.094 0 3 1.324 3 2v1c0 1.038.627 3 3 3h7.5c.827 0 1.5.673 1.5 1.5V13h-8.25zM9.5 5c.276 0 .5-.224.5-.5v-1C10 2.673 9.327 2 8.5 2h-4C3.673 2 3 2.673 3 3.5v1c0 .276.224.5.5.5s.5-.224.5-.5v-1c0-.276.225-.5.5-.5h4c.275 0 .5.224.5.5v1c0 .276.224.5.5.5zM21 10c-4.963 0-9 4.038-9 9s4.037 9 9 9 9-4.038 9-9-4.037-9-9-9zm0 17c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"></path></symbol> <symbol id="code2" viewBox="0 0 45 42"><path fill="#c99065" d="M14.46 32.79l-1.17 1.17q-.235.235-.54.235t-.54-.234L1.29 23.04q-.235-.235-.235-.54t.234-.54l10.92-10.92q.235-.235.54-.235t.54.234l1.17 1.17q.235.235.235.54t-.234.54L5.25 22.5l9.21 9.21q.235.235.235.54t-.234.54zM28.314 7.78L19.57 38.04q-.093.304-.362.456t-.55.06l-1.454-.4q-.305-.093-.457-.362t-.06-.574L25.43 6.962q.094-.305.363-.457t.55-.06l1.454.4q.305.093.457.362t.06.574zM43.71 23.04L32.79 33.96q-.235.235-.54.235t-.54-.234l-1.17-1.17q-.235-.235-.235-.54t.234-.54l9.21-9.21-9.21-9.21q-.235-.235-.235-.54t.234-.54l1.17-1.17q.235-.235.54-.235t.54.234l10.92 10.92q.235.235.235.54t-.234.54z"></path></symbol> <symbol id="icon-next" viewBox="0 0 16.827499389648438 31.908498764038086"><path d="M12.576 35.954c-.253 0-.507-.097-.7-.292-.387-.39-.387-1.02 0-1.41L26.024 20 11.876 5.748c-.387-.39-.387-1.02 0-1.41.387-.39 1.013-.39 1.4 0l14.847 14.957c.387.39.387 1.02 0 1.41L13.276 35.662c-.193.195-.446.292-.7.292z"></path></symbol> <symbol id="icon-prev" viewBox="0 0 16.82849884033203 31.908498764038086"><path d="M26.724 35.662L11.876 20.705c-.387-.39-.387-1.02 0-1.41L26.724 4.338c.387-.39 1.013-.39 1.4 0s.387 1.02 0 1.41L13.976 20l14.148 14.252c.387.39.387 1.02 0 1.41-.193.195-.447.292-.7.292-.254 0-.507-.097-.7-.292z"></path></symbol> <symbol id="icon-quote-mark" viewBox="0 0 52.23600387573242 38.71699905395508"><path d="M50.692 9.732c-12.207 6.16-18.31 14.697-18.31 25.615 0 3.64 1.148 6.733 3.444 9.28 2.295 2.548 5.01 3.82 8.146 3.82 2.8 0 5.123-.978 6.97-2.938 1.85-1.96 2.772-4.368 2.772-7.224 0-2.688-.953-5.052-2.855-7.097-1.905-2.044-4.313-3.234-7.224-3.57 0-4.535 3.415-8.482 10.246-11.842l-3.19-6.046zm-30.822 0C7.72 15.892 1.645 24.43 1.645 35.347c0 3.64 1.134 6.733 3.4 9.28 2.27 2.548 4.97 3.82 8.105 3.82 2.8 0 5.136-.978 7.013-2.938 1.875-1.96 2.813-4.368 2.813-7.224 0-2.688-.953-5.052-2.856-7.097-1.904-2.044-4.34-3.234-7.307-3.57 0-4.535 3.443-8.482 10.33-11.842L19.87 9.732z"></path></symbol> <symbol id="logo" viewBox="0 0 125 125"><g fill="#fff"><path d="m64.8 59.2h-5v-5.4h2.9c2.9 0 5-.7 6.3-2.1 1.4-1.4 2-3.4 2-5.9 0-2.2-.7-4.2-2.2-5.8s-3.5-2.5-6-2.5-4.6.8-6.3 2.5-2.5 3.8-2.5 6.2v29.2c1 1.2 2.4 2.1 4 2.8 1.7.7 3.5 1 5.6 1 3 0 5.4-.9 7.2-2.8 1.7-1.9 2.6-4.3 2.6-7.3 0-2.6-.8-4.9-2.3-7-1.6-1.9-3.7-2.9-6.3-2.9z"></path> <path d="m62.5 0 40.738119 14.8274629 21.676301 37.5444539-7.5281 42.6939777-33.2100194 27.8665145h-43.3526012l-33.21001925-27.8665145-7.52810007-42.6939777 21.67630062-37.5444539zm.3 32.1c-4.3 0-8 1.4-11.1 4.2s-4.7 6.1-4.7 10v51.2h7v-15.9c1.3 1.1 2.9 1.9 4.7 2.4s3.7.8 5.6.8c4.7 0 8.5-1.4 11.5-4.2s4.4-6.6 4.4-11.4c0-3-.8-5.7-2.3-8s-3.7-4-6.5-5c2-1.1 3.6-2.5 4.8-4.3 1.1-1.8 1.7-3.8 1.7-5.9 0-4.1-1.3-7.4-4.1-10s-6.4-3.9-11-3.9z"></path></g></symbol> <symbol id="mobile2" viewBox="0 0 32 32"><path fill="#c99065" d="M1.5 32h14c.276 0 .5-.224.5-.5s-.224-.5-.5-.5h-14c-.276 0-.5-.224-.5-.5v-29c0-.276.224-.5.5-.5h21c.276 0 .5.224.5.5v5c0 .276.224.5.5.5s.5-.224.5-.5v-5c0-.827-.673-1.5-1.5-1.5h-21C.673 0 0 .673 0 1.5v29c0 .827.673 1.5 1.5 1.5zM18 10.5v20c0 .827.673 1.5 1.5 1.5h11c.827 0 1.5-.673 1.5-1.5v-20c0-.827-.673-1.5-1.5-1.5h-11c-.827 0-1.5.673-1.5 1.5zm13 0v20c0 .276-.224.5-.5.5h-11c-.276 0-.5-.224-.5-.5v-20c0-.276.224-.5.5-.5h11c.276 0 .5.224.5.5zM11 28c0 .552.448 1 1 1s1-.448 1-1-.448-1-1-1-1 .448-1 1zm13 0c0 .552.448 1 1 1s1-.448 1-1-.448-1-1-1-1 .448-1 1z"></path></symbol> <symbol id="mouse" viewBox="6 0 95 95"><path d="M53.5 71.5c-8.3 0-15-6.7-15-15v-18c0-8.3 6.7-15 15-15s15 6.7 15 15v18c0 8.3-6.7 15-15 15zm0-45c-6.6 0-12 5.4-12 12v18c0 6.6 5.4 12 12 12s12-5.4 12-12v-18c0-6.6-5.4-12-12-12zm.2 17.5c-2.1 0-3.8-1.7-3.8-3.8v-4.5c0-2.1 1.7-3.8 3.8-3.8s3.8 1.7 3.8 3.8v4.5c-.1 2.1-1.7 3.8-3.8 3.8zm0-9c-.4 0-.8.3-.8.8v4.5c0 .4.3.8.8.8s.8-.3.8-.8v-4.5c-.1-.4-.4-.8-.8-.8z"></path></symbol> <symbol id="pencil" viewBox="0 0 92 92"><path d="M65.4 28.5c.3-1.1-.8-2.2-1.8-1.8l-12.1 3.8-.2.1-.3.1-.2.1-19 19-4.8 4.8c-.6.6-.6 1.5 0 2.1l8.3 8.3c.6.6 1.5.6 2.1 0l4.7-4.7 19-19 .1-.2.1-.1.1-.2c.1-.2 4-12.3 4-12.3zm-6.2 9.6l-3.5-1.8-1.8-3.5 7.8-2.4c0-.1-2.5 7.7-2.5 7.7zm-18 19L35 50.9l16.5-16.5 1.9 3.7c.1.1.2.3.3.4.1.1.2.2.4.3l3.7 1.9c-.2-.1-16.6 16.4-16.6 16.4zm-4.8 4.7l-6.2-6.2 2.6-2.6 6.2 6.2-2.6 2.6z"></path></symbol> <symbol id="pencil2" viewBox="0 0 32 32"><path fill="#c99065" d="M0 31.48c0 .275.224.5.5.5h31.11c.068 0 .133-.014.194-.04s.116-.063.162-.11h.003c.002-.004.002-.01.006-.013.05-.055.084-.122.107-.195.007-.023.01-.045.014-.07.004-.024.015-.046.015-.072 0-.04-.014-.075-.023-.112-.004-.014.002-.028-.003-.042l-3.16-9.715c-.024-.074-.066-.143-.122-.198L11.688 4.294c-.018-.028-.03-.058-.055-.083L7.893.473c-.606-.607-1.594-.607-2.202 0L.457 5.707C.162 6 0 6.392 0 6.807s.162.81.456 1.103l3.656 3.656c.018.027.03.058.054.082l17.09 17.205c.06.06.13.103.212.127l6.713 2H.5c-.276 0-.5.223-.5.5zm6.362-21.32L22.05 25.648l-.578 2.002L5.227 11.295l1.135-1.135zM22.816 25L7.068 9.455l2.437-2.437 15.607 15.648V25h-2.296zm2.92-3.125L10.21 6.31l1.04-1.038 16.21 16.21-1.727.393zM22.987 26h2.624c.276 0 .5-.224.5-.5v-2.685l2.007-.456 2.722 8.37-8.488-2.53.634-2.2zM1 6.808c0-.15.058-.288.163-.394L6.398 1.18c.217-.218.57-.22.79 0l3.37 3.37-6.022 6.024-3.372-3.372C1.058 7.097 1 6.957 1 6.808z"></path></symbol> <symbol id="video" viewBox="0.5 0 95 95"><path d="M73.5 30h-51c-.8 0-1.5.7-1.5 1.5v32c0 .8.7 1.5 1.5 1.5h51c.8 0 1.5-.7 1.5-1.5v-32c0-.8-.7-1.5-1.5-1.5zM72 62H24V33h48v29zM41 39v17l14-8.5L41 39z"></path></symbol></svg></div> <header class="header blog-slug" data-v-4405246c><a href="/" aria-label="Home" class="logo" data-v-4405246c><svg class="icon" data-v-4405246c><use xlink:href="#logo" data-v-4405246c></use></svg></a> <nav data-v-4405246c><a href="/#about-me" data-v-4405246c> About Me </a> <a href="/#work" data-v-4405246c> Work </a> <a href="/blog" data-v-4405246c> Blog </a> <a href="/#contact" data-v-4405246c> Contact </a></nav> <h1 class="header__title" data-v-4405246c><span data-v-4405246c>Blog</span></h1> <p class="kicker" data-v-4405246c>Byron Buckley</p></header> <section class="font-sans leading-normal tracking-normal"><article class="container w-full md:max-w-3xl mx-auto pt-8" data-v-039a705c><div class="w-full px-4 md:px-6 text-xl text-gray-800 leading-normal" style="font-family:Georgia,serif" data-v-039a705c><div class="font-sans" data-v-039a705c><p class="text-base md:text-sm font-bold" data-v-039a705c><a href="/blog" class="back-link nuxt-link-active" data-v-039a705c> &lt; Back to Blog </a></p> <h1 class="font-bold font-sans break-normal text-gray-900 pt-6 pb-2 text-3xl md:text-4xl" data-v-039a705c>
        Visual Regression Tests for Storybooks
      </h1> <p class="published" data-v-039a705c>Published September 22, 2023</p> <p data-v-039a705c>Implementing visual regression testing in Storybook with Storyshots and Puppeteer.</p></div> <ul class="toc" data-v-039a705c><li class="toc2" data-v-039a705c><a href="/blog/visual-regression-testing#why-visual-regression-testing" data-v-039a705c>Why Visual Regression Testing</a></li><li class="toc2" data-v-039a705c><a href="/blog/visual-regression-testing#common-tools" data-v-039a705c>Common Tools</a></li><li class="toc2" data-v-039a705c><a href="/blog/visual-regression-testing#using-storyshots" data-v-039a705c>Using Storyshots</a></li><li class="toc2" data-v-039a705c><a href="/blog/visual-regression-testing#challenges" data-v-039a705c>Challenges</a></li><li class="toc2" data-v-039a705c><a href="/blog/visual-regression-testing#outcome" data-v-039a705c>Outcome</a></li><li class="toc2" data-v-039a705c><a href="/blog/visual-regression-testing#next-steps" data-v-039a705c>Next Steps</a></li><li class="toc2" data-v-039a705c><a href="/blog/visual-regression-testing#conclusion" data-v-039a705c>Conclusion</a></li><li class="toc2" data-v-039a705c><a href="/blog/visual-regression-testing#links-and-references" data-v-039a705c>Links and references</a></li></ul> <div class="nuxt-content" data-v-039a705c data-v-039a705c><p data-v-039a705c data-v-039a705c>Visual regression testing is an essential practice in software development that helps build confidence when making changes to codebases, such as refactors or dependency version upgrades. In this blog post, I will look at implementing visual regression testing in Storybook, and discuss some common tools and techniques used in this process.</p>
<h2 id="why-visual-regression-testing" data-v-039a705c data-v-039a705c><a href="#why-visual-regression-testing" aria-hidden="true" tabindex="-1" data-v-039a705c data-v-039a705c><span class="icon icon-link" data-v-039a705c data-v-039a705c></span></a>Why Visual Regression Testing</h2>
<p data-v-039a705c data-v-039a705c>When working on a project, especially on an internal design system, it is crucial to ensure that any changes made do not introduce unintended visual bugs or regressions. Visual regression testing allows us to compare the visual output of a component or UI element before and after specific changes, helping us identify any unexpected visual discrepancies.</p>
<p data-v-039a705c data-v-039a705c>As a developer working on an internal design system, I understand the importance of maintaining a stable and visually consistent UI. Our design system is built using the Carbon Design System, which provides a set of reusable components and guidelines. However, like any software, it is essential to regularly update and upgrade our dependencies to benefit from bug fixes and new features.</p>
<h2 id="common-tools" data-v-039a705c data-v-039a705c><a href="#common-tools" aria-hidden="true" tabindex="-1" data-v-039a705c data-v-039a705c><span class="icon icon-link" data-v-039a705c data-v-039a705c></span></a>Common Tools</h2>
<p data-v-039a705c data-v-039a705c>There are many tools for visual testing. The Storybook team recommends Chromatic to run visual tests in a lightning-fast cloud browser environment. However in this article I'll implement StoryShots, their self-managed alternative to Chromatic. It allows you to run visual tests on stories by integrating with <a href="https://github.com/storybookjs/storybook/tree/main/code/addons/storyshots-puppeteer#imagesnapshots" rel="nofollow noopener noreferrer" target="_blank" data-v-039a705c data-v-039a705c>jest-image-snapshot</a>.</p>
<p data-v-039a705c data-v-039a705c>Jest is a widely used testing framework in the JavaScript ecosystem. By using the <code data-v-039a705c data-v-039a705c>@storybook/addon-storyshots</code> addon, we can leverage Jest's image snapshot feature to capture screenshots of our Storybook stories and compare them with existing reference images.</p>
<h2 id="using-storyshots" data-v-039a705c data-v-039a705c><a href="#using-storyshots" aria-hidden="true" tabindex="-1" data-v-039a705c data-v-039a705c><span class="icon icon-link" data-v-039a705c data-v-039a705c></span></a>Using Storyshots</h2>
<p data-v-039a705c data-v-039a705c>To get started with visual regression testing using Storybooks, we need to set up and configure the Storyshots addon. Here are the steps involved.</p>
<h3 id="installation" data-v-039a705c data-v-039a705c><a href="#installation" aria-hidden="true" tabindex="-1" data-v-039a705c data-v-039a705c><span class="icon icon-link" data-v-039a705c data-v-039a705c></span></a>Installation</h3>
<p data-v-039a705c data-v-039a705c>First, we need to install the necessary dependencies. In our project's directory, we can run the following commands:</p>
<div class="nuxt-content-highlight" data-v-039a705c data-v-039a705c><pre class="line-numbers language-shell" data-v-039a705c data-v-039a705c><code data-v-039a705c data-v-039a705c><span class="token function" data-v-039a705c data-v-039a705c>npm</span> <span class="token function" data-v-039a705c data-v-039a705c>install</span> --save-dev @storybook/addon-storyshots
<span class="token function" data-v-039a705c data-v-039a705c>npm</span> <span class="token function" data-v-039a705c data-v-039a705c>install</span> @storybook/addon-storyshots-puppeteer puppeteer --save-dev
</code></pre></div>
<p data-v-039a705c data-v-039a705c>Next, we need to update our <code data-v-039a705c data-v-039a705c>package.json</code> file with the following scripts:</p>
<div class="nuxt-content-highlight" data-v-039a705c data-v-039a705c><pre class="line-numbers language-json" data-v-039a705c data-v-039a705c><code data-v-039a705c data-v-039a705c><span class="token property" data-v-039a705c data-v-039a705c>"scripts"</span><span class="token operator" data-v-039a705c data-v-039a705c>:</span> <span class="token punctuation" data-v-039a705c data-v-039a705c>{</span>
  <span class="token property" data-v-039a705c data-v-039a705c>"snapshot:ds"</span><span class="token operator" data-v-039a705c data-v-039a705c>:</span> <span class="token string" data-v-039a705c data-v-039a705c>"cross-env TZ=UTC jest --config=jest.snapshots.config.js --testPathPattern=/snapshots/index.ts"</span><span class="token punctuation" data-v-039a705c data-v-039a705c>,</span>
  <span class="token property" data-v-039a705c data-v-039a705c>"presnapshot:ds"</span><span class="token operator" data-v-039a705c data-v-039a705c>:</span> <span class="token string" data-v-039a705c data-v-039a705c>"npm run storybook:build-ds"</span><span class="token punctuation" data-v-039a705c data-v-039a705c>,</span>
  <span class="token property" data-v-039a705c data-v-039a705c>"update-snapshot:ds"</span><span class="token operator" data-v-039a705c data-v-039a705c>:</span> <span class="token string" data-v-039a705c data-v-039a705c>"npm run snapshot:ds -u"</span><span class="token punctuation" data-v-039a705c data-v-039a705c>,</span>
<span class="token punctuation" data-v-039a705c data-v-039a705c>}</span>
</code></pre></div>
<p data-v-039a705c data-v-039a705c>Here's what each script does:</p>
<ul data-v-039a705c data-v-039a705c>
<li data-v-039a705c data-v-039a705c><code data-v-039a705c data-v-039a705c>snapshot:ds</code>: Runs Jest with a specific configuration file (<code data-v-039a705c data-v-039a705c>jest.snapshots.config.js</code>) and runs tests that match the pattern <code data-v-039a705c data-v-039a705c>/snapshots/index.ts</code>. This script is used to generate snapshots of the project's components and compare them to the previously generated snapshots to detect any visual changes.</li>
<li data-v-039a705c data-v-039a705c><code data-v-039a705c data-v-039a705c>presnapshot:ds</code>: Builds the project's Storybook, which is a UI development environment that allows developers to view and interact with the project's components in isolation. This script is run before generating snapshots to ensure that the latest version of the components is used.</li>
<li data-v-039a705c data-v-039a705c><code data-v-039a705c data-v-039a705c>update-snapshot:ds</code>: Runs Jest with the <code data-v-039a705c data-v-039a705c>-u</code> flag to update the snapshots that were generated by the <code data-v-039a705c data-v-039a705c>snapshot:ds</code> script. This script is used when the developer has made changes to the components that affect their visual appearance and wants to update the snapshots accordingly.</li>
</ul>
<h3 id="types-of-tests" data-v-039a705c data-v-039a705c><a href="#types-of-tests" aria-hidden="true" tabindex="-1" data-v-039a705c data-v-039a705c><span class="icon icon-link" data-v-039a705c data-v-039a705c></span></a>Types of Tests</h3>
<h4 id="configuring-image-snapshots" data-v-039a705c data-v-039a705c><a href="#configuring-image-snapshots" aria-hidden="true" tabindex="-1" data-v-039a705c data-v-039a705c><span class="icon icon-link" data-v-039a705c data-v-039a705c></span></a>Configuring Image Snapshots</h4>
<p data-v-039a705c data-v-039a705c>To configure image snapshots, create a test file, such as <code data-v-039a705c data-v-039a705c>/snapshots/index.js</code>. In this file, we can define our test cases using Jest's <code data-v-039a705c data-v-039a705c>toMatchImageSnapshot</code> matcher. Here is a basic example:</p>
<div class="nuxt-content-highlight" data-v-039a705c data-v-039a705c><pre class="line-numbers language-javascript" data-v-039a705c data-v-039a705c><code data-v-039a705c data-v-039a705c><span class="token keyword module" data-v-039a705c data-v-039a705c>import</span> <span class="token imports" data-v-039a705c data-v-039a705c>initStoryshots</span> <span class="token keyword module" data-v-039a705c data-v-039a705c>from</span> <span class="token string" data-v-039a705c data-v-039a705c>'@storybook/addon-storyshots'</span><span class="token punctuation" data-v-039a705c data-v-039a705c>;</span>

<span class="token function" data-v-039a705c data-v-039a705c>initStoryshots</span><span class="token punctuation" data-v-039a705c data-v-039a705c>(</span><span class="token punctuation" data-v-039a705c data-v-039a705c>{</span>
  framework<span class="token operator" data-v-039a705c data-v-039a705c>:</span> <span class="token string" data-v-039a705c data-v-039a705c>'react'</span><span class="token punctuation" data-v-039a705c data-v-039a705c>,</span>
  <span class="token function-variable function" data-v-039a705c data-v-039a705c>test</span><span class="token operator" data-v-039a705c data-v-039a705c>:</span> <span class="token punctuation" data-v-039a705c data-v-039a705c>(</span><span class="token parameter" data-v-039a705c data-v-039a705c><span class="token punctuation" data-v-039a705c data-v-039a705c>{</span> story <span class="token punctuation" data-v-039a705c data-v-039a705c>}</span></span><span class="token punctuation" data-v-039a705c data-v-039a705c>)</span> <span class="token arrow operator" data-v-039a705c data-v-039a705c>=></span> <span class="token punctuation" data-v-039a705c data-v-039a705c>{</span>
    <span class="token function" data-v-039a705c data-v-039a705c>expect</span><span class="token punctuation" data-v-039a705c data-v-039a705c>(</span>story<span class="token punctuation" data-v-039a705c data-v-039a705c>.</span><span class="token method function property-access" data-v-039a705c data-v-039a705c>render</span><span class="token punctuation" data-v-039a705c data-v-039a705c>(</span><span class="token punctuation" data-v-039a705c data-v-039a705c>)</span><span class="token punctuation" data-v-039a705c data-v-039a705c>)</span><span class="token punctuation" data-v-039a705c data-v-039a705c>.</span><span class="token method function property-access" data-v-039a705c data-v-039a705c>toMatchImageSnapshot</span><span class="token punctuation" data-v-039a705c data-v-039a705c>(</span><span class="token punctuation" data-v-039a705c data-v-039a705c>)</span><span class="token punctuation" data-v-039a705c data-v-039a705c>;</span>
  <span class="token punctuation" data-v-039a705c data-v-039a705c>}</span><span class="token punctuation" data-v-039a705c data-v-039a705c>,</span>
<span class="token punctuation" data-v-039a705c data-v-039a705c>}</span><span class="token punctuation" data-v-039a705c data-v-039a705c>)</span><span class="token punctuation" data-v-039a705c data-v-039a705c>;</span>
</code></pre></div>
<p data-v-039a705c data-v-039a705c><img alt="Inside my test file" src="/assets/blog/visual-regression-testing/snapshot-config.png" data-v-039a705c data-v-039a705c></p>
<figcaption data-v-039a705c data-v-039a705c>The two `initStoryshots` methods represent two suites of tests</figcaption>
<p data-v-039a705c data-v-039a705c>By running the <code data-v-039a705c data-v-039a705c>npm run snapshot:ds</code> command, Jest will capture screenshots of all our stories and compare them against the reference images stored in the <code data-v-039a705c data-v-039a705c>__image_snapshots__</code> directory. Any visual differences will be highlighted as failing tests.</p>
<h2 id="challenges" data-v-039a705c data-v-039a705c><a href="#challenges" aria-hidden="true" tabindex="-1" data-v-039a705c data-v-039a705c><span class="icon icon-link" data-v-039a705c data-v-039a705c></span></a>Challenges</h2>
<p data-v-039a705c data-v-039a705c>During the visual regression testing process, we may encounter a few challenges that require additional attention and consideration.</p>
<h3 id="stories-requiring-interactions" data-v-039a705c data-v-039a705c><a href="#stories-requiring-interactions" aria-hidden="true" tabindex="-1" data-v-039a705c data-v-039a705c><span class="icon icon-link" data-v-039a705c data-v-039a705c></span></a>Stories Requiring Interactions</h3>
<p data-v-039a705c data-v-039a705c>Some stories in our Storybook may have interactive elements or user interactions. Testing such scenarios can be challenging, as capturing a single screenshot may not be sufficient to cover all possible states. In these cases, we need to consider using techniques like Puppeteer to programmatically interact with the component and capture screenshots at different stages.</p>
<figure data-v-039a705c data-v-039a705c>
  <video autoplay loop muted playsinline="true" controls data-v-039a705c data-v-039a705c>
    <source src="/assets/blog/visual-regression-testing/action-container.mp4" type="video/mp4" data-v-039a705c data-v-039a705c>
    Your browser does not support the video tag.
  </video>
  <figcaption data-v-039a705c data-v-039a705c>Component requiring a hover prior to snapshot.</figcaption>
</figure>
<p data-v-039a705c data-v-039a705c>To do so insert the appropriate code into the stories that need special steps before the snapshot is taken. For example, if a component requires a hover action, we can add the following code to the story:</p>
<div class="nuxt-content-highlight" data-v-039a705c data-v-039a705c><pre class="line-numbers language-typescript" data-v-039a705c data-v-039a705c><code data-v-039a705c data-v-039a705c><span class="token comment" data-v-039a705c data-v-039a705c>// ActionContainer.stories.tsx</span>
<span class="token keyword" data-v-039a705c data-v-039a705c>const</span> <span class="token function-variable function" data-v-039a705c data-v-039a705c>activateActionContainer</span> <span class="token operator" data-v-039a705c data-v-039a705c>=</span> <span class="token keyword" data-v-039a705c data-v-039a705c>async</span> <span class="token punctuation" data-v-039a705c data-v-039a705c>(</span>page<span class="token operator" data-v-039a705c data-v-039a705c>:</span> <span class="token builtin" data-v-039a705c data-v-039a705c>any</span><span class="token punctuation" data-v-039a705c data-v-039a705c>)</span> <span class="token operator" data-v-039a705c data-v-039a705c>=></span> <span class="token punctuation" data-v-039a705c data-v-039a705c>{</span>
  <span class="token keyword" data-v-039a705c data-v-039a705c>const</span> selector <span class="token operator" data-v-039a705c data-v-039a705c>=</span> <span class="token string" data-v-039a705c data-v-039a705c>".ds--action-container"</span><span class="token punctuation" data-v-039a705c data-v-039a705c>;</span>
  <span class="token keyword" data-v-039a705c data-v-039a705c>await</span> <span class="token builtin" data-v-039a705c data-v-039a705c>Promise</span><span class="token punctuation" data-v-039a705c data-v-039a705c>.</span><span class="token function" data-v-039a705c data-v-039a705c>all</span><span class="token punctuation" data-v-039a705c data-v-039a705c>(</span><span class="token punctuation" data-v-039a705c data-v-039a705c>[</span>
    page<span class="token punctuation" data-v-039a705c data-v-039a705c>.</span><span class="token function" data-v-039a705c data-v-039a705c>waitForNavigation</span><span class="token punctuation" data-v-039a705c data-v-039a705c>(</span><span class="token punctuation" data-v-039a705c data-v-039a705c>)</span><span class="token punctuation" data-v-039a705c data-v-039a705c>,</span>
    page<span class="token punctuation" data-v-039a705c data-v-039a705c>.</span><span class="token function" data-v-039a705c data-v-039a705c>waitForSelector</span><span class="token punctuation" data-v-039a705c data-v-039a705c>(</span>selector<span class="token punctuation" data-v-039a705c data-v-039a705c>)</span><span class="token punctuation" data-v-039a705c data-v-039a705c>,</span>
    page<span class="token punctuation" data-v-039a705c data-v-039a705c>.</span><span class="token function" data-v-039a705c data-v-039a705c>hover</span><span class="token punctuation" data-v-039a705c data-v-039a705c>(</span><span class="token string" data-v-039a705c data-v-039a705c>".ds--action-container"</span><span class="token punctuation" data-v-039a705c data-v-039a705c>)</span><span class="token punctuation" data-v-039a705c data-v-039a705c>,</span>
    page<span class="token punctuation" data-v-039a705c data-v-039a705c>.</span><span class="token function" data-v-039a705c data-v-039a705c>waitForTimeout</span><span class="token punctuation" data-v-039a705c data-v-039a705c>(</span><span class="token number" data-v-039a705c data-v-039a705c>1000</span><span class="token punctuation" data-v-039a705c data-v-039a705c>)</span><span class="token punctuation" data-v-039a705c data-v-039a705c>,</span>
  <span class="token punctuation" data-v-039a705c data-v-039a705c>]</span><span class="token punctuation" data-v-039a705c data-v-039a705c>)</span><span class="token punctuation" data-v-039a705c data-v-039a705c>;</span>
  <span class="token keyword" data-v-039a705c data-v-039a705c>const</span> element <span class="token operator" data-v-039a705c data-v-039a705c>=</span> <span class="token keyword" data-v-039a705c data-v-039a705c>await</span> page<span class="token punctuation" data-v-039a705c data-v-039a705c>.</span><span class="token function" data-v-039a705c data-v-039a705c>$</span><span class="token punctuation" data-v-039a705c data-v-039a705c>(</span><span class="token string" data-v-039a705c data-v-039a705c>".ds--action-container"</span><span class="token punctuation" data-v-039a705c data-v-039a705c>)</span><span class="token punctuation" data-v-039a705c data-v-039a705c>;</span>
  <span class="token function" data-v-039a705c data-v-039a705c>expect</span><span class="token punctuation" data-v-039a705c data-v-039a705c>(</span><span class="token keyword" data-v-039a705c data-v-039a705c>await</span> element<span class="token punctuation" data-v-039a705c data-v-039a705c>.</span><span class="token function" data-v-039a705c data-v-039a705c>screenshot</span><span class="token punctuation" data-v-039a705c data-v-039a705c>(</span><span class="token punctuation" data-v-039a705c data-v-039a705c>)</span><span class="token punctuation" data-v-039a705c data-v-039a705c>)</span><span class="token punctuation" data-v-039a705c data-v-039a705c>.</span><span class="token function" data-v-039a705c data-v-039a705c>toMatchImageSnapshot</span><span class="token punctuation" data-v-039a705c data-v-039a705c>(</span><span class="token punctuation" data-v-039a705c data-v-039a705c>)</span><span class="token punctuation" data-v-039a705c data-v-039a705c>;</span>
<span class="token punctuation" data-v-039a705c data-v-039a705c>}</span><span class="token punctuation" data-v-039a705c data-v-039a705c>;</span>

Default<span class="token punctuation" data-v-039a705c data-v-039a705c>.</span>parameters <span class="token operator" data-v-039a705c data-v-039a705c>=</span> <span class="token punctuation" data-v-039a705c data-v-039a705c>{</span>
  <span class="token keyword" data-v-039a705c data-v-039a705c>async</span> <span class="token function" data-v-039a705c data-v-039a705c>puppeteerTest</span><span class="token punctuation" data-v-039a705c data-v-039a705c>(</span>page<span class="token operator" data-v-039a705c data-v-039a705c>:</span> <span class="token builtin" data-v-039a705c data-v-039a705c>any</span><span class="token punctuation" data-v-039a705c data-v-039a705c>)</span> <span class="token punctuation" data-v-039a705c data-v-039a705c>{</span>
    <span class="token keyword" data-v-039a705c data-v-039a705c>await</span> <span class="token function" data-v-039a705c data-v-039a705c>activateActionContainer</span><span class="token punctuation" data-v-039a705c data-v-039a705c>(</span>page<span class="token punctuation" data-v-039a705c data-v-039a705c>)</span><span class="token punctuation" data-v-039a705c data-v-039a705c>;</span>
  <span class="token punctuation" data-v-039a705c data-v-039a705c>}</span><span class="token punctuation" data-v-039a705c data-v-039a705c>,</span>
<span class="token punctuation" data-v-039a705c data-v-039a705c>}</span><span class="token punctuation" data-v-039a705c data-v-039a705c>;</span>

<span class="token doc-comment comment" data-v-039a705c data-v-039a705c>/**
 * Override the puppeteerTest() method in each story where present
 */</span>
<span class="token comment" data-v-039a705c data-v-039a705c>// snapshot/index.ts</span>
<span class="token function" data-v-039a705c data-v-039a705c>initStoryshots</span><span class="token punctuation" data-v-039a705c data-v-039a705c>(</span><span class="token punctuation" data-v-039a705c data-v-039a705c>{</span>
  <span class="token operator" data-v-039a705c data-v-039a705c>...</span>storyshotsConfig<span class="token punctuation" data-v-039a705c data-v-039a705c>,</span>
  suite<span class="token operator" data-v-039a705c data-v-039a705c>:</span> <span class="token string" data-v-039a705c data-v-039a705c>"Design System - Combinations"</span><span class="token punctuation" data-v-039a705c data-v-039a705c>,</span>
  storyKindRegex<span class="token operator" data-v-039a705c data-v-039a705c>:</span> <span class="token regex" data-v-039a705c data-v-039a705c><span class="token regex-delimiter" data-v-039a705c data-v-039a705c>/</span><span class="token regex-source language-regex" data-v-039a705c data-v-039a705c><span class="token anchor function" data-v-039a705c data-v-039a705c>^</span>Components<span class="token escape" data-v-039a705c data-v-039a705c>\/</span><span class="token group punctuation" data-v-039a705c data-v-039a705c>(?!</span>ActionContainer<span class="token alternation keyword" data-v-039a705c data-v-039a705c>|</span>Default Input Focussed<span class="token group punctuation" data-v-039a705c data-v-039a705c>)</span><span class="token charclass class-name" data-v-039a705c data-v-039a705c>.</span><span class="token quantifier number" data-v-039a705c data-v-039a705c>*</span></span><span class="token regex-delimiter" data-v-039a705c data-v-039a705c>/</span></span><span class="token punctuation" data-v-039a705c data-v-039a705c>,</span> <span class="token comment" data-v-039a705c data-v-039a705c>// exclude interactive stories</span>
  test<span class="token operator" data-v-039a705c data-v-039a705c>:</span> <span class="token function" data-v-039a705c data-v-039a705c>puppeteerTest</span><span class="token punctuation" data-v-039a705c data-v-039a705c>(</span><span class="token punctuation" data-v-039a705c data-v-039a705c>{</span>
    <span class="token operator" data-v-039a705c data-v-039a705c>...</span><span class="token function" data-v-039a705c data-v-039a705c>testConfig</span><span class="token punctuation" data-v-039a705c data-v-039a705c>(</span><span class="token punctuation" data-v-039a705c data-v-039a705c>)</span><span class="token punctuation" data-v-039a705c data-v-039a705c>,</span>
  <span class="token punctuation" data-v-039a705c data-v-039a705c>}</span><span class="token punctuation" data-v-039a705c data-v-039a705c>)</span><span class="token punctuation" data-v-039a705c data-v-039a705c>,</span>
<span class="token punctuation" data-v-039a705c data-v-039a705c>}</span><span class="token punctuation" data-v-039a705c data-v-039a705c>)</span><span class="token punctuation" data-v-039a705c data-v-039a705c>;</span>
</code></pre></div>
<h3 id="dynamically-generating-snapshots-for-storybook-controls" data-v-039a705c data-v-039a705c><a href="#dynamically-generating-snapshots-for-storybook-controls" aria-hidden="true" tabindex="-1" data-v-039a705c data-v-039a705c><span class="icon icon-link" data-v-039a705c data-v-039a705c></span></a>Dynamically Generating Snapshots for Storybook Controls</h3>
<p data-v-039a705c data-v-039a705c>Storybook provides various controls that allow us to change the props and state of our components dynamically. However, capturing screenshots for all possible combinations of these controls can be impractical. To overcome this challenge, we can write code to programmatically generate snapshots for a subset of important combinations or focus on testing the default state of the components.</p>
<div class="nuxt-content-highlight" data-v-039a705c data-v-039a705c><pre class="line-numbers language-typescript" data-v-039a705c data-v-039a705c><code data-v-039a705c data-v-039a705c><span class="token doc-comment comment" data-v-039a705c data-v-039a705c>/**
 * <span class="token keyword" data-v-039a705c data-v-039a705c>@param</span> <span class="token parameter" data-v-039a705c data-v-039a705c>initialUrl</span> - The initial URL of the page.
 * <span class="token keyword" data-v-039a705c data-v-039a705c>@returns</span> A function that takes snapshots of a page with different control states.
 */</span>
<span class="token comment" data-v-039a705c data-v-039a705c>// utils/snapshot.ts</span>
<span class="token keyword" data-v-039a705c data-v-039a705c>export</span> <span class="token keyword" data-v-039a705c data-v-039a705c>const</span> <span class="token function-variable function" data-v-039a705c data-v-039a705c>takeSnapshotsFactory</span> <span class="token operator" data-v-039a705c data-v-039a705c>=</span> <span class="token punctuation" data-v-039a705c data-v-039a705c>(</span>initialUrl<span class="token operator" data-v-039a705c data-v-039a705c>:</span> <span class="token builtin" data-v-039a705c data-v-039a705c>string</span><span class="token punctuation" data-v-039a705c data-v-039a705c>)</span> <span class="token operator" data-v-039a705c data-v-039a705c>=></span> <span class="token punctuation" data-v-039a705c data-v-039a705c>{</span>
  <span class="token keyword" data-v-039a705c data-v-039a705c>return</span> <span class="token keyword" data-v-039a705c data-v-039a705c>async</span> <span class="token punctuation" data-v-039a705c data-v-039a705c>(</span>page<span class="token operator" data-v-039a705c data-v-039a705c>:</span> <span class="token builtin" data-v-039a705c data-v-039a705c>any</span><span class="token punctuation" data-v-039a705c data-v-039a705c>,</span> states<span class="token operator" data-v-039a705c data-v-039a705c>:</span> Record<span class="token operator" data-v-039a705c data-v-039a705c>&lt;</span><span class="token builtin" data-v-039a705c data-v-039a705c>string</span><span class="token punctuation" data-v-039a705c data-v-039a705c>,</span> <span class="token builtin" data-v-039a705c data-v-039a705c>boolean</span><span class="token punctuation" data-v-039a705c data-v-039a705c>[</span><span class="token punctuation" data-v-039a705c data-v-039a705c>]</span> <span class="token operator" data-v-039a705c data-v-039a705c>|</span> <span class="token builtin" data-v-039a705c data-v-039a705c>string</span><span class="token punctuation" data-v-039a705c data-v-039a705c>[</span><span class="token punctuation" data-v-039a705c data-v-039a705c>]</span><span class="token operator" data-v-039a705c data-v-039a705c>></span><span class="token punctuation" data-v-039a705c data-v-039a705c>,</span> timeout<span class="token operator" data-v-039a705c data-v-039a705c>?</span><span class="token operator" data-v-039a705c data-v-039a705c>:</span> <span class="token builtin" data-v-039a705c data-v-039a705c>number</span><span class="token punctuation" data-v-039a705c data-v-039a705c>)</span> <span class="token operator" data-v-039a705c data-v-039a705c>=></span> <span class="token punctuation" data-v-039a705c data-v-039a705c>{</span>
    <span class="token keyword" data-v-039a705c data-v-039a705c>for</span> <span class="token punctuation" data-v-039a705c data-v-039a705c>(</span><span class="token keyword" data-v-039a705c data-v-039a705c>const</span> controls <span class="token keyword" data-v-039a705c data-v-039a705c>of</span> Object<span class="token punctuation" data-v-039a705c data-v-039a705c>.</span><span class="token function" data-v-039a705c data-v-039a705c>keys</span><span class="token punctuation" data-v-039a705c data-v-039a705c>(</span>states<span class="token punctuation" data-v-039a705c data-v-039a705c>)</span><span class="token punctuation" data-v-039a705c data-v-039a705c>)</span> <span class="token punctuation" data-v-039a705c data-v-039a705c>{</span>
      <span class="token keyword" data-v-039a705c data-v-039a705c>const</span> args <span class="token operator" data-v-039a705c data-v-039a705c>=</span> states<span class="token punctuation" data-v-039a705c data-v-039a705c>[</span>controls<span class="token punctuation" data-v-039a705c data-v-039a705c>]</span><span class="token punctuation" data-v-039a705c data-v-039a705c>;</span>
      <span class="token keyword" data-v-039a705c data-v-039a705c>for</span> <span class="token punctuation" data-v-039a705c data-v-039a705c>(</span><span class="token keyword" data-v-039a705c data-v-039a705c>const</span> value <span class="token keyword" data-v-039a705c data-v-039a705c>of</span> args<span class="token punctuation" data-v-039a705c data-v-039a705c>)</span> <span class="token punctuation" data-v-039a705c data-v-039a705c>{</span>
        <span class="token keyword" data-v-039a705c data-v-039a705c>await</span> page<span class="token punctuation" data-v-039a705c data-v-039a705c>.</span><span class="token function" data-v-039a705c data-v-039a705c>goto</span><span class="token punctuation" data-v-039a705c data-v-039a705c>(</span><span class="token template-string" data-v-039a705c data-v-039a705c><span class="token template-punctuation string" data-v-039a705c data-v-039a705c>`</span><span class="token interpolation" data-v-039a705c data-v-039a705c><span class="token interpolation-punctuation punctuation" data-v-039a705c data-v-039a705c>${</span>initialUrl<span class="token interpolation-punctuation punctuation" data-v-039a705c data-v-039a705c>}</span></span><span class="token string" data-v-039a705c data-v-039a705c>&args=</span><span class="token interpolation" data-v-039a705c data-v-039a705c><span class="token interpolation-punctuation punctuation" data-v-039a705c data-v-039a705c>${</span>controls<span class="token interpolation-punctuation punctuation" data-v-039a705c data-v-039a705c>}</span></span><span class="token string" data-v-039a705c data-v-039a705c>:</span><span class="token interpolation" data-v-039a705c data-v-039a705c><span class="token interpolation-punctuation punctuation" data-v-039a705c data-v-039a705c>${</span>value<span class="token interpolation-punctuation punctuation" data-v-039a705c data-v-039a705c>}</span></span><span class="token template-punctuation string" data-v-039a705c data-v-039a705c>`</span></span><span class="token punctuation" data-v-039a705c data-v-039a705c>,</span> <span class="token punctuation" data-v-039a705c data-v-039a705c>{</span>
          waitUntil<span class="token operator" data-v-039a705c data-v-039a705c>:</span> <span class="token string" data-v-039a705c data-v-039a705c>"networkidle2"</span><span class="token punctuation" data-v-039a705c data-v-039a705c>,</span>
          timeout<span class="token operator" data-v-039a705c data-v-039a705c>:</span> timeout <span class="token operator" data-v-039a705c data-v-039a705c>||</span> <span class="token number" data-v-039a705c data-v-039a705c>30000</span><span class="token punctuation" data-v-039a705c data-v-039a705c>,</span> <span class="token comment" data-v-039a705c data-v-039a705c>// use provided timeout or default to 30 seconds</span>
        <span class="token punctuation" data-v-039a705c data-v-039a705c>}</span><span class="token punctuation" data-v-039a705c data-v-039a705c>)</span><span class="token punctuation" data-v-039a705c data-v-039a705c>;</span>
        <span class="token function" data-v-039a705c data-v-039a705c>expect</span><span class="token punctuation" data-v-039a705c data-v-039a705c>(</span><span class="token keyword" data-v-039a705c data-v-039a705c>await</span> page<span class="token punctuation" data-v-039a705c data-v-039a705c>.</span><span class="token function" data-v-039a705c data-v-039a705c>screenshot</span><span class="token punctuation" data-v-039a705c data-v-039a705c>(</span><span class="token punctuation" data-v-039a705c data-v-039a705c>)</span><span class="token punctuation" data-v-039a705c data-v-039a705c>)</span><span class="token punctuation" data-v-039a705c data-v-039a705c>.</span><span class="token function" data-v-039a705c data-v-039a705c>toMatchImageSnapshot</span><span class="token punctuation" data-v-039a705c data-v-039a705c>(</span><span class="token punctuation" data-v-039a705c data-v-039a705c>{</span>
          <span class="token function-variable function" data-v-039a705c data-v-039a705c>customSnapshotIdentifier</span><span class="token operator" data-v-039a705c data-v-039a705c>:</span> <span class="token punctuation" data-v-039a705c data-v-039a705c>(</span><span class="token punctuation" data-v-039a705c data-v-039a705c>{</span> defaultIdentifier <span class="token punctuation" data-v-039a705c data-v-039a705c>}</span><span class="token punctuation" data-v-039a705c data-v-039a705c>)</span> <span class="token operator" data-v-039a705c data-v-039a705c>=></span> <span class="token template-string" data-v-039a705c data-v-039a705c><span class="token template-punctuation string" data-v-039a705c data-v-039a705c>`</span><span class="token interpolation" data-v-039a705c data-v-039a705c><span class="token interpolation-punctuation punctuation" data-v-039a705c data-v-039a705c>${</span>defaultIdentifier<span class="token interpolation-punctuation punctuation" data-v-039a705c data-v-039a705c>}</span></span><span class="token string" data-v-039a705c data-v-039a705c>-</span><span class="token interpolation" data-v-039a705c data-v-039a705c><span class="token interpolation-punctuation punctuation" data-v-039a705c data-v-039a705c>${</span>controls<span class="token interpolation-punctuation punctuation" data-v-039a705c data-v-039a705c>}</span></span><span class="token string" data-v-039a705c data-v-039a705c>-</span><span class="token interpolation" data-v-039a705c data-v-039a705c><span class="token interpolation-punctuation punctuation" data-v-039a705c data-v-039a705c>${</span>value<span class="token interpolation-punctuation punctuation" data-v-039a705c data-v-039a705c>}</span></span><span class="token template-punctuation string" data-v-039a705c data-v-039a705c>`</span></span><span class="token punctuation" data-v-039a705c data-v-039a705c>,</span>
        <span class="token punctuation" data-v-039a705c data-v-039a705c>}</span><span class="token punctuation" data-v-039a705c data-v-039a705c>)</span><span class="token punctuation" data-v-039a705c data-v-039a705c>;</span>
      <span class="token punctuation" data-v-039a705c data-v-039a705c>}</span>
    <span class="token punctuation" data-v-039a705c data-v-039a705c>}</span>
  <span class="token punctuation" data-v-039a705c data-v-039a705c>}</span><span class="token punctuation" data-v-039a705c data-v-039a705c>;</span>
<span class="token punctuation" data-v-039a705c data-v-039a705c>}</span><span class="token punctuation" data-v-039a705c data-v-039a705c>;</span>

<span class="token doc-comment comment" data-v-039a705c data-v-039a705c>/**
 * configure snapshot images
 */</span>
<span class="token comment" data-v-039a705c data-v-039a705c>// Accordion.stories.tsx</span>
Default<span class="token punctuation" data-v-039a705c data-v-039a705c>.</span>parameters <span class="token operator" data-v-039a705c data-v-039a705c>=</span> <span class="token punctuation" data-v-039a705c data-v-039a705c>{</span>
  <span class="token keyword" data-v-039a705c data-v-039a705c>async</span> <span class="token function" data-v-039a705c data-v-039a705c>puppeteerTest</span><span class="token punctuation" data-v-039a705c data-v-039a705c>(</span>page<span class="token operator" data-v-039a705c data-v-039a705c>:</span> <span class="token builtin" data-v-039a705c data-v-039a705c>any</span><span class="token punctuation" data-v-039a705c data-v-039a705c>)</span> <span class="token punctuation" data-v-039a705c data-v-039a705c>{</span>
    <span class="token keyword" data-v-039a705c data-v-039a705c>const</span> initialUrl <span class="token operator" data-v-039a705c data-v-039a705c>=</span> <span class="token keyword" data-v-039a705c data-v-039a705c>await</span> page<span class="token punctuation" data-v-039a705c data-v-039a705c>.</span><span class="token function" data-v-039a705c data-v-039a705c>url</span><span class="token punctuation" data-v-039a705c data-v-039a705c>(</span><span class="token punctuation" data-v-039a705c data-v-039a705c>)</span><span class="token punctuation" data-v-039a705c data-v-039a705c>;</span>

    <span class="token keyword" data-v-039a705c data-v-039a705c>const</span> states <span class="token operator" data-v-039a705c data-v-039a705c>=</span> <span class="token punctuation" data-v-039a705c data-v-039a705c>{</span>
      align<span class="token operator" data-v-039a705c data-v-039a705c>:</span> <span class="token punctuation" data-v-039a705c data-v-039a705c>[</span><span class="token string" data-v-039a705c data-v-039a705c>"start"</span><span class="token punctuation" data-v-039a705c data-v-039a705c>,</span> <span class="token string" data-v-039a705c data-v-039a705c>"end"</span><span class="token punctuation" data-v-039a705c data-v-039a705c>]</span><span class="token punctuation" data-v-039a705c data-v-039a705c>,</span>
      isFlush<span class="token operator" data-v-039a705c data-v-039a705c>:</span> <span class="token punctuation" data-v-039a705c data-v-039a705c>[</span><span class="token boolean" data-v-039a705c data-v-039a705c>true</span><span class="token punctuation" data-v-039a705c data-v-039a705c>]</span><span class="token punctuation" data-v-039a705c data-v-039a705c>,</span>
      size<span class="token operator" data-v-039a705c data-v-039a705c>:</span> <span class="token punctuation" data-v-039a705c data-v-039a705c>[</span><span class="token string" data-v-039a705c data-v-039a705c>"sm"</span><span class="token punctuation" data-v-039a705c data-v-039a705c>,</span> <span class="token string" data-v-039a705c data-v-039a705c>"md"</span><span class="token punctuation" data-v-039a705c data-v-039a705c>,</span> <span class="token string" data-v-039a705c data-v-039a705c>"lg"</span><span class="token punctuation" data-v-039a705c data-v-039a705c>]</span><span class="token punctuation" data-v-039a705c data-v-039a705c>,</span>
    <span class="token punctuation" data-v-039a705c data-v-039a705c>}</span>

    <span class="token keyword" data-v-039a705c data-v-039a705c>const</span> takeSnapshots <span class="token operator" data-v-039a705c data-v-039a705c>=</span> <span class="token function" data-v-039a705c data-v-039a705c>takeSnapshotsFactory</span><span class="token punctuation" data-v-039a705c data-v-039a705c>(</span>initialUrl<span class="token punctuation" data-v-039a705c data-v-039a705c>)</span><span class="token punctuation" data-v-039a705c data-v-039a705c>;</span>
    <span class="token keyword" data-v-039a705c data-v-039a705c>await</span> <span class="token function" data-v-039a705c data-v-039a705c>takeSnapshots</span><span class="token punctuation" data-v-039a705c data-v-039a705c>(</span>page<span class="token punctuation" data-v-039a705c data-v-039a705c>,</span> states<span class="token punctuation" data-v-039a705c data-v-039a705c>)</span><span class="token punctuation" data-v-039a705c data-v-039a705c>;</span>
  <span class="token punctuation" data-v-039a705c data-v-039a705c>}</span>
<span class="token punctuation" data-v-039a705c data-v-039a705c>}</span><span class="token punctuation" data-v-039a705c data-v-039a705c>;</span>
</code></pre></div>
<p data-v-039a705c data-v-039a705c><img alt="Inside my test file" src="/assets/blog/visual-regression-testing/accordion-snapshots.png" data-v-039a705c data-v-039a705c></p>
<figcaption data-v-039a705c data-v-039a705c>Three of the eight snapshots generated by the previous code snippet.</figcaption>
<h2 id="outcome" data-v-039a705c data-v-039a705c><a href="#outcome" aria-hidden="true" tabindex="-1" data-v-039a705c data-v-039a705c><span class="icon icon-link" data-v-039a705c data-v-039a705c></span></a>Outcome</h2>
<p data-v-039a705c data-v-039a705c>After performing the upgrade on our internal design system and running the visual regression tests, we can examine the results. The tests will generate image diffs, highlighting any visual discrepancies between the upgraded and reference versions of our components. These diffs provide valuable insights into any unexpected changes and help us identify potential issues before they impact the components built with the design system as well as our users.</p>
<h2 id="next-steps" data-v-039a705c data-v-039a705c><a href="#next-steps" aria-hidden="true" tabindex="-1" data-v-039a705c data-v-039a705c><span class="icon icon-link" data-v-039a705c data-v-039a705c></span></a>Next Steps</h2>
<p data-v-039a705c data-v-039a705c>To ensure that visual regression testing becomes an integral part of our development process, we should consider running these tests from our continuous integration(CI) system. This ensures that any changes made to our codebase are automatically tested for visual regressions, providing an early indication of any issues that may arise.</p>
<p data-v-039a705c data-v-039a705c>Additionally, it is important to regularly update our reference images to account for intentional design changes or improvements. This helps maintain the accuracy of our visual regression tests and avoids false positives.</p>
<h2 id="conclusion" data-v-039a705c data-v-039a705c><a href="#conclusion" aria-hidden="true" tabindex="-1" data-v-039a705c data-v-039a705c><span class="icon icon-link" data-v-039a705c data-v-039a705c></span></a>Conclusion</h2>
<p data-v-039a705c data-v-039a705c>Visual regression testing for Storybooks is a valuable practice that helps ensure the stability and consistency of our UI components. By comparing screenshots of our components before and after specific changes, we can identify any unintended visual discrepancies and address them promptly. With the help of tools like Puppeteer, Jest and the <code data-v-039a705c data-v-039a705c>@storybook/addon-storyshots</code> addon, we can easily set up and configure visual regression tests for our Storybooks. By integrating these tests into our development process, we can build confidence in our code changes and deliver a visually consistent user experience to our users.</p>
<h2 id="links-and-references" data-v-039a705c data-v-039a705c><a href="#links-and-references" aria-hidden="true" tabindex="-1" data-v-039a705c data-v-039a705c><span class="icon icon-link" data-v-039a705c data-v-039a705c></span></a>Links and references</h2>
<ul data-v-039a705c data-v-039a705c>
<li data-v-039a705c data-v-039a705c><a href="https://storybook.js.org/docs/react/writing-tests/visual-testing" rel="nofollow noopener noreferrer" target="_blank" data-v-039a705c data-v-039a705c>https://storybook.js.org/docs/react/writing-tests/visual-testing</a></li>
<li data-v-039a705c data-v-039a705c><a href="https://github.com/storybookjs/storybook/tree/next/code/addons/storyshots-core" rel="nofollow noopener noreferrer" target="_blank" data-v-039a705c data-v-039a705c>https://github.com/storybookjs/storybook/tree/next/code/addons/storyshots-core</a></li>
</ul></div></div> <hr class="border-b-2 border-gray-400 mb-8 mx-4" data-v-039a705c> <div class="blog-navigation font-sans flex justify-between content-center px-4 pb-12" data-v-bb1fc93c data-v-039a705c><div class="text-left" data-v-bb1fc93c><span class="text-xs md:text-sm font-normal text-gray-600" data-v-bb1fc93c>&lt; Previous Post</span><br data-v-bb1fc93c> <p data-v-bb1fc93c><a href="/blog/drag-drop-affordance" class="md:text-sm" data-v-bb1fc93c>
        Increasing Affordance for Drag & Drop Interactions when using React-DnD
      </a></p></div> <div class="text-right" data-v-bb1fc93c><span class="text-xs md:text-sm font-normal text-gray-600" data-v-bb1fc93c>Next Post ></span><br data-v-bb1fc93c> <p data-v-bb1fc93c><a href="/blog/react-query-transform" class="md:text-sm" data-v-bb1fc93c>
        React Query Data Transformations: Using the Select Option
      </a></p></div></div></article></section> <footer><div class="lockup"><div class="content-wrap"><a href="/" aria-label="Home" class="logo"><svg height="123" viewBox="0 0 125 123" width="125" xmlns="http://www.w3.org/2000/svg"><g fill="#c99065"><path d="m64.8 59.2h-5v-5.4h2.9c2.9 0 5-.7 6.3-2.1 1.4-1.4 2-3.4 2-5.9 0-2.2-.7-4.2-2.2-5.8s-3.5-2.5-6-2.5-4.6.8-6.3 2.5-2.5 3.8-2.5 6.2v29.2c1 1.2 2.4 2.1 4 2.8 1.7.7 3.5 1 5.6 1 3 0 5.4-.9 7.2-2.8 1.7-1.9 2.6-4.3 2.6-7.3 0-2.6-.8-4.9-2.3-7-1.6-1.9-3.7-2.9-6.3-2.9z"></path> <path d="m62.5 0 40.738119 14.8274629 21.676301 37.5444539-7.5281 42.6939777-33.2100194 27.8665145h-43.3526012l-33.21001925-27.8665145-7.52810007-42.6939777 21.67630062-37.5444539zm.3 32.1c-4.3 0-8 1.4-11.1 4.2s-4.7 6.1-4.7 10v51.2h7v-15.9c1.3 1.1 2.9 1.9 4.7 2.4s3.7.8 5.6.8c4.7 0 8.5-1.4 11.5-4.2s4.4-6.6 4.4-11.4c0-3-.8-5.7-2.3-8s-3.7-4-6.5-5c2-1.1 3.6-2.5 4.8-4.3 1.1-1.8 1.7-3.8 1.7-5.9 0-4.1-1.3-7.4-4.1-10s-6.4-3.9-11-3.9z"></path></g></svg></a> <nav><a href="/#about-me"> About Me </a> <a href="/#work"> Work </a> <a href="/blog">
          Blog
          <span class="visuallyhidden">Note: Link opens a new window.</span></a> <a href="/#contact"> Contact </a></nav></div></div></footer></div></div></div><script>window.__NUXT__={staticAssetsBase:"/_nuxt/static/1695680987",layout:"default",error:null,serverRendered:!0,routePath:"/blog/visual-regression-testing",config:{content:{dbHash:"9a2e05aa"}}}</script><script src="/_nuxt/878f78e.js" defer></script><script src="/_nuxt/6441c06.js" defer></script><script src="/_nuxt/184d8ea.js" defer></script><script src="/_nuxt/b14aa09.js" defer></script><script src="/_nuxt/a190463.js" defer></script>
  </body>
</html>
